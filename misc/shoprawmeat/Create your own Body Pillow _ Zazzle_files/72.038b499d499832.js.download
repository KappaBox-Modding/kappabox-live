(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[72],{1596:function(e,t,c){"use strict";c.d(t,"a",(function(){return V}));var i=c(1),a=c(666),r=c(28),s=c(7),d=c(4),o=c(8),l=c(147),n=c(1565),b=c(12),O=c(566),u=c(85),j=c(323),m=c(11),y=c(86),g=c(37),p=c(50),I=c(25),f=c(52),h=c(129),v=c(391),P=c(2);const S={};function D(e=S,t){switch(t.type){case v.a.UPDATE_STATE:return Object(P.a)(Object(P.a)({},e),t.payload)}return e}let _=!1;function*k(e){const t=Object(u.e)(yield Object(i.k)(),e.designStateKey);let c;Object(j.o)("StartCollab");try{const r=a.DesignCollabClient.createNew({apiUrl:"/svc/z3/collaboration/",authData:{csrfToken:Object(s.a)().csrf}},t.design.id,e.origin,e.emails,void 0,e.public);c=yield Object(i.c)(()=>r)}catch(r){return}yield Object(i.i)(Object(b.Kc)(e.designStateKey,{isShowingNavigateToCollabDialog:{collabId:c.getCollabId(),emails:e.emails,public:e.public,shortLink:e.public?c.getShortLink():void 0}}))}function*w(e){const t=Object(r.b)(yield Object(i.k)()),c=Object(g.d)(yield Object(i.k)(),e.productStateKey),{collabId:d}=e,n=Object(h.l)(c.stateKey),{designStateKey:O}=c,u=Object(h.k)(c.stateKey),m=a.DesignCollabClient.create({apiUrl:"/svc/z3/collaboration/",authData:{csrfToken:Object(s.a)().csrf},collabId:d,requestTimeoutMs:t("Int32","www","Chat.RequestTimeoutMs",5e3),roomRejoinIntervalMs:t("Int32","www","Chat.RoomRejoinIntervalMs",1e4),socketUrl:Object(s.a)().zsockServerUrl},void 0,2),y=yield Object(i.c)(()=>m);yield Object(i.i)(Object(p.c)(n,D,{assetIds:y.getAssetIds(),collabId:y.getCollabId(),dateCreated:y.getDescriptor().dateCreated,driverId:y.getDriver().participant.memberId,isLive:y.getIsLive(),isPublic:y.isPublic(),members:y.getAllUsers(),myId:y.getMyself(),ownerId:y.getOwner().participant.memberId,pendingEmails:y.getDescriptor().pendingEmails,shortLink:y.getShortLink()})),yield Object(i.i)(Object(l.rb)({client:y,chatStateKey:u}));const I=Object(o.c)(yield Object(i.k)());y.onPermissionDisconnect(()=>{_=!0,alert(I("zi_create_Collab_KickedMessage")),window.location.href=window.location.origin}),yield Object(i.g)(C,n),yield Object(i.g)(A,n,y),yield Object(i.g)(E,n,O,y),yield Object(i.g)(T,O,y),yield Object(i.g)(U,O,y),yield Object(i.g)(R,n,y),yield Object(i.g)(L,O,y),yield Object(i.g)(z,n,y),yield Object(i.g)(M,n,y),yield Object(i.g)(N,n,y),yield Object(i.g)(K,n,y),yield Object(i.g)(B,n,y),yield Object(i.b)([Object(i.n)(v.a.ADD_COLLABORATOR,(function*(e){y.addUser(e.memberId)})),Object(i.n)(v.a.ADD_COLLABORATORS_VIA_EMAIL,(function*(e){yield Object(i.c)(()=>y.addUsersByEmail(e.emails));const t=1===e.emails.length?I("zi_create_Collab_InvitePalette_InvitationSent"):I("zi_create_Collab_InvitePalette_InvitationsSent");yield Object(i.i)(b.yb.enqueueToast(O,{value:"ðŸŽ‰ "+t})),yield Object(i.c)(()=>y.refreshDescriptor());const c=y.getDescriptor().pendingEmails;yield Object(i.i)(v.b.updateState(n,{pendingEmails:c})),Object(j.o)("InviteCollab")})),Object(i.n)(v.a.ADD_IMAGES,(function*(e){e.imageIds.forEach(e=>y.addAsset(e))})),Object(i.n)(v.a.GIVE_CONTROL,(function*(e){y.giveDriver(e.memberId)})),Object(i.n)(v.a.INFORM_UI_CHANGED,(function*(e){y.getMyself()===y.getDriver().participant.memberId&&y.updateUI(e.uiState)})),Object(i.n)(v.a.RESPOND_END_SESSION,(function*(e){const t=yield Object(i.k)(),c=Object(h.d)(t,n);y.emitAppealDecision(c.appealRequest,{appealRequest:c.appealRequest,decision:e.decision}),yield Object(i.i)(v.b.updateState(n,{appeal:void 0,appealRequest:void 0}))})),Object(i.n)(v.a.REQUEST_END_SESSION,(function*(e){y.appeal({type:"APPEAL_END_COLLABORATION"})})),Object(i.n)(v.a.SET_PRIVACY,(function*(e){y.changePrivacy(e.isPublic)})),Object(i.n)(v.a.REMOVE_COLLABORATOR,(function*(e){y.removeUser(e.memberId)})),Object(i.n)(v.a.YIELD_TO_OWNER,(function*(){y.yieldDriver()}))])}function*C(e){for(;;){var t;const{collabId:a,isInVideoRoom:r,members:s}=Object(h.d)(yield Object(i.k)(),e),o=s.filter(e=>e.connectedCount>0).length>1;let l;if(!r&&o&&!_)try{l=yield Object(i.c)(()=>Object(d.c)("/svc/z3/collaboration/getactivevideochat",{collabId:a}))}catch(c){}const n=(null===(t=l)||void 0===t?void 0:t.success)&&l.data.participantsCount>0;yield Object(i.i)(v.b.updateState(e,{hasVideoChat:n})),yield Object(i.f)(5e3)}}function*A(e,t){for(;;){const[c,a]=yield Object(i.c)(()=>new Promise(e=>t.onAppeal((t,c)=>{e([t,c])})));yield Object(i.i)(v.b.updateState(e,{appeal:c,appealRequest:a}))}}function*E(e,t,c){for(;;){yield Object(i.c)(()=>new Promise(e=>c.onAssetAdded(e))),yield Object(i.i)(v.b.updateState(e,{assetIds:c.getAssetIds()})),yield Object(i.i)(Object(b.Kc)(t,{hasNewSharedAsset:!0},!1));if(c.getDriver().participant.memberId===c.getMyself()){const e=Object(o.c)(yield Object(i.k)());yield Object(i.i)(b.yb.enqueueToast(t,{value:e("zi_create_Z4_DesignSpace_NewSharedAssetToast")}))}}}function*T(e,t){for(;;){const{designResponse:c,uiInfo:a}=yield Object(i.j)({designResponse:Object(i.c)(()=>new Promise(e=>t.onDesignUpdate(e))),uiInfo:Object(i.c)(()=>new Promise(e=>{t.onUIChange(e)}))});if(c){const t=yield Object(i.k)(),a=Object(u.e)(yield Object(i.k)(),e),r=Object(O.d)(a,!1,t.page.internalEditMode).transformResponse(c),s=b.vb.handleRLVSocketDesignUpdate(e,r);yield Object(i.i)(s),yield Object(f.c)(s)}else if(a){if(!(t.getDriver().participant.memberId===t.getMyself())&&a.targetArea){const t=Object(b.Ac)(e,void 0,a.targetArea);yield Object(i.i)(t),yield Object(f.c)(t)}}}}function*U(e,t){for(;;){yield Object(i.c)(()=>new Promise(e=>t.onEndCollaboration(e))),_=!0;const c=yield Object(i.k)(),a=Object(I.b)(c,e),r=Object(g.d)(c,a.productStateKey),s=Object(y.a)(c,Object(h.h)(e)),d=Object(h.l)(r.stateKey),l=Object(h.d)(c,d);if(s&&l&&s.customer_id===l.myId)yield Object(i.i)(Object(b.Kc)(e,{isShowingSessionSummaryDialog:!0}));else{const e=Object(o.c)(c);alert(e("zi_create_Collab_KickedMessage")),window.location.href=window.location.origin}}}function*R(e,t){for(;;)yield Object(i.c)(()=>new Promise(e=>t.onChangePrivacy(e))),yield Object(i.i)(v.b.updateState(e,{isPublic:t.isPublic()}))}function*L(e,t){const c=Object(h.g)(e);for(;;){yield Object(i.c)(()=>new Promise(e=>t.onNewDriver(e)));if(t.getDriver().participant.memberId===t.getMyself()){yield Object(i.i)(b.vb.flushRenderDesign(e)),yield Object(i.i)(b.vb.changeOptions(e,{}));const t=Object(o.c)(yield Object(i.k)());yield Object(i.i)(b.yb.enqueueToast(e,{value:t("zi_create_Collab_YouAreNowInControl")}))}yield Object(i.i)(v.b.updateState(c,{driverId:t.getDriver().participant.memberId}))}}function*z(e,t){for(;;){yield Object(i.c)(()=>new Promise(e=>t.onUserAdd(e)));const c=t.getAllUsers();yield Object(i.i)(v.b.updateState(e,{members:c})),yield Object(i.c)(()=>t.refreshDescriptor());const a=t.getDescriptor().pendingEmails;yield Object(i.i)(v.b.updateState(e,{pendingEmails:a}))}}function*M(e,t){for(;;){yield Object(i.c)(()=>new Promise(e=>t.onUserJoin(e)));const c=t.getAllUsers();yield Object(i.i)(v.b.updateState(e,{members:c}))}}function*N(e,t){for(;;){yield Object(i.c)(()=>new Promise(e=>t.onUserLeave(e)));const c=t.getAllUsers();yield Object(i.i)(v.b.updateState(e,{members:c}))}}function*K(e,t){for(;;){yield Object(i.c)(()=>new Promise(e=>t.onUserRemove(e)));const c=t.getAllUsers();yield Object(i.i)(v.b.updateState(e,{members:c}))}}function*B(e,t){for(;;){yield Object(i.c)(()=>new Promise(e=>t.onUsersUpdated(e)));const c=t.getAllUsers();yield Object(i.i)(v.b.updateState(e,{members:c}))}}function*q(e){var t;const c=Object(h.e)(e._stateKey),a=yield Object(i.k)(),r=Object(y.a)(a,Object(h.h)(c));let s;try{const t=e.viaTimeout?"Duration complete":void 0;s=yield Object(i.c)(()=>Object(d.e)("/svc/z3/live/endjob",{jobId:r.id,details:t}))}catch(o){}(null===(t=s)||void 0===t?void 0:t.success)&&(yield Object(i.i)(Object(m.c)(s.data.entities)),yield Object(i.i)(Object(b.Kc)(c,{isShowingSessionSummaryDialog:!0})))}function*V(){yield Object(i.b)([Object(i.g)(n.a),Object(i.n)(v.a.INITIALIZE_EXISTING,w),Object(i.n)(v.a.CREATE_NEW,k),Object(i.n)(v.a.END_LIVE_JOB,q)])}},840:function(e,t,c){"use strict";c.d(t,"b",(function(){return D})),c.d(t,"a",(function(){return _}));var i=c(2),a=c(146),r=c.n(a),s=c(1),d=c(198),o=c(12),l=c(97),n=c(37),b=c(25),O=c(52),u=c(63),j=c(7),m=c(4),y=c(13),g=c(103),p=c(286);function I(e,t,c,i,a){return`share_${function(e){let t=u.e.Consumer;"0"!==e.memberId&&(t=e.belongsToMakerGroup?e.isSeller?u.e.MakerDesigner:u.e.Maker:e.isSeller?u.e.Designer:u.e.Member);return t}(e)}${t}${c}${i}${a?"t":"f"}`}function*f(e){if(e.sharedItemType===u.d.PDPProduct)yield Object(s.g)(P,e);else if(e.sharedItemType===u.d.Profile){const t=e.sharedItem,c={success:!0,imageUrl:t.imageUrl,url:t.link||t.linkUrl};e.callback(c)}else e.sharedItemType===u.d.IdeaBoard?yield Object(s.g)(v,e):e.sharedItemType===u.d.MarketplaceProduct&&(yield Object(s.g)(h,e))}function*h(e){const t=e.sharedItem,c={lang:Object(j.a)().languageTwoLetter,ppd:t.id,returnImageUrl:e.getImage,url:t.linkUrl};try{const t=yield Object(s.c)(m.c,"/svc/z3/share/getshorturl",c);t.success&&e.callback(t.data)}catch(i){}}function*v(e){const t=e.sharedItem,c={ideaboardId:t.boardId};try{const i=yield Object(s.c)(m.c,"/svc/z3/share/getideaboardurls",c);if(i.success){const c={imageSizeUrls:i.data.imageSizeUrls,imageUrl:t.coverThumbnail,success:!0,url:t.url};e.callback(c)}}catch(i){}}function*P(e){const t=yield Object(s.k)(),c=e.sharedItem,i=Object(n.d)(t,c.stateKey),a=Object(b.b)(t,i.designStateKey);if(i.isCustomizing&&a.settings.persistentSaveIsStale){const e=Object(o.ec)(a.stateKey);yield Object(s.i)(e),yield Object(O.c)(e)}const u={customized:i.isCustomizing||i.hasUserTitle||!i.isPublic,dz:Object(l.g)(i,Object(b.b)(t,i.designStateKey)),isCustomizing:i.isCustomizing,lang:Object(j.a)().languageTwoLetter,maxDim:void 0,po:i.productOption,ppd:i.id||i.rootProductId,productUrl:i.url,returnImageUrl:e.getImage,ta:i.isCustomizing?void 0:y.a.toString(r()(Object(d.a)(i.templates),encodeURIComponent)),view:i.preferredRealviewId};try{const t=yield Object(s.c)(m.c,"/svc/z3/share/getshortproductshareurl",u);t.success&&e.callback(t.data)}catch(g){}}function*S(e){const{sharedItemId:t,sharedItemType:c}=e,i=yield Object(s.k)();let a;switch(c){case u.d.Cart:a="Cart";break;case u.d.IdeaBoard:a="IdeaBoard";break;case u.d.MarketplaceProduct:case u.d.PDPProduct:a="Product";break;case u.d.Profile:a="Profile"}i.User.isLoggedIn&&(yield Object(s.c)(m.e,"/svc/profile/profilecompletionitemshared",{sharedItemId:t,sharedItemType:a}))}function*D(e){const t=yield Object(s.k)(),c=e.sharedItem;if(e.sharedItemType===u.d.PDPProduct&&u.c.PDPProduct(c,u.d.PDPProduct)){const o=c,l=t.User,n=Object(y.i)(Object(i.a)({view:o.preferredRealviewId},!o.isCustomizing&&Object(d.a)(o.templates))),b=I(l,u.a.PDPProduct,u.b.Email,e.sharedItemType,l.memberId===o.designerId||l.memberId===o.merchantSellerId&&"0"!==o.merchantSellerId),O=Object(i.a)(Object(i.a)({},e.emailParams),{},{papId:o.rootProductId,productParams:n,shareTrackingCode:b});o.isCustomizing?O.designId=o.designId:O.productId=o.id;const j=yield Object(s.c)(m.e,"/svc/z3/share/sendemail",O);var a,r;return j.success?(null===(a=e.callback)||void 0===a||a.call(e,!0),{success:!0,responseData:j}):(yield*Object(g.a)({message:j.error.message}),null===(r=e.callback)||void 0===r||r.call(e,!1),!1)}if(e.sharedItemType===u.d.MarketplaceProduct&&u.c.MarketplaceProduct(c,u.d.MarketplaceProduct)){const a=c,r=t.User,d=I(r,u.a.StoreProducts,u.b.Email,e.sharedItemType,r.memberId===a.ownerId),n=Object(i.a)(Object(i.a)({},e.emailParams),{},{papId:a.id,productId:a.id,shareTrackingCode:d}),b=yield Object(s.c)(m.e,"/svc/z3/share/sendemail",n);var o,l;return b.success?(null===(o=e.callback)||void 0===o||o.call(e,!0),{success:!0,responseData:b}):(yield*Object(g.a)({message:b.error.message}),null===(l=e.callback)||void 0===l||l.call(e,!1),!1)}if(e.sharedItemType===u.d.IdeaBoard&&u.c.Ideaboard(c,u.d.IdeaBoard)){const a=c,r=t.User,d=I(r,u.a.IdeaBoard,u.b.Email,e.sharedItemType,a.owner===r.memberId),o=Object(i.a)(Object(i.a)({},e.emailParams),{},{ideaBoardId:a.boardId,shareTrackingCode:d}),l=yield Object(s.c)(m.e,"/svc/z3/share/sendideaboardshareemail",o);var n,b;return l.success?(null===(n=e.callback)||void 0===n||n.call(e,!0),{success:!0,responseData:l}):(yield*Object(g.a)({message:l.error.message}),null===(b=e.callback)||void 0===b||b.call(e,!1),!1)}if(e.sharedItemType===u.d.Profile&&u.c.Profile(c,u.d.Profile)){const a=c,r=t.User,d=I(r,u.a.StoreHome,u.b.Email,e.sharedItemType,a.memberOwnerId===r.memberId),o=Object(i.a)(Object(i.a)({},e.emailParams),{},{shareTrackingCode:d,profileId:"Store"===a.type?a.storeId:a.makerGroupId}),l=yield Object(s.c)(m.e,"/svc/z3/share/sendProfileShareEmail",o);var O,j;return l.success?(null===(O=e.callback)||void 0===O||O.call(e,!0),{success:!0,responseData:l}):(yield*Object(g.a)({message:l.error.message}),null===(j=e.callback)||void 0===j||j.call(e,!1),!1)}throw new Error("Error sharing email, unrecognized action.sharedItemType")}function*_(){yield Object(s.b)([Object(s.n)(p.b,D),Object(s.n)(p.c,S),Object(s.n)(p.a,f)])}}}]);